<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:psd="http://www.w3.org/1999/xhtml" lang="ca">
<head>
    <meta charset="UTF-8"/>
    <title>Plantilles</title>
</head>
<body>

<div class="container-fluid px-4" style="max-width: 100%;">
    <div th:fragment="header(titol)">
        <div class="list-header">
            <div class="text-right mb-3">
                <a th:href="@{/templates/create}" class="btn btn-success" title="Crear plantilla">
                    <i class="fa fa-plus-circle"></i>
                    Nova plantilla
                </a>
                <!-- Button trigger modal importar plantilla-->
                <button type="button" class="btn btn-success" data-toggle="modal" data-target="#exampleModal">
                    <i class="fa fa-arrow-up"></i>
                    Importar plantilla
                </button>

                <!-- Modal importar plantilla-->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg modal-fullscreen-sm-down">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Importar plantilla</h1>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>

                            <!-- Formulari per pujar arxiu de plantilla -->
                            <div class="modal-body bg-light">
                                <div class="text-center mb-4">
                                    <div class="d-inline-flex align-items-center justify-content-center bg-primary text-white rounded-circle"
                                         style="width:60px; height:60px;">
                                        <i class="fa fa-upload fa-2x"></i>
                                    </div>
                                    <h5 class="mt-3 mb-1 text-dark font-weight-bold">Importar plantilla</h5>
                                    <p class="text-muted mb-0">Selecciona un arxiu des del teu ordinador per importar
                                        una plantilla.</p>
                                    <small class="text-muted">Formats admesos: .json</small>
                                </div>

                                <div class="form-group mt-4">
                                    <label for="fileInput" class="font-weight-bold text-secondary">
                                        <i class="fa fa-file mr-1 text-primary"></i> Arxiu
                                    </label>
                                    <div class="custom-file">
                                        <input type="file"
                                               id="fileInput"
                                               name="file"
                                               class="custom-file-input"
                                               accept=".json"
                                               required
                                               oninvalid="this.setCustomValidity('Cal especificar el fitxer que conté la plantilla.')"
                                               oninput="setCustomValidity('')">
                                        <label class="custom-file-label" for="fileInput" style="text-align: left;">Tria
                                            un arxiu...</label>
                                    </div>
                                </div>
                            </div>

                            <div class="modal-footer bg-white border-0">
                                <button type="button" class="btn btn-light border" data-dismiss="modal">
                                    <i class="fa fa-ban mr-1"></i> Cancel·lar
                                </button>
                                <button type="button" class="btn btn-primary shadow-sm" onclick="importTemplate()">
                                    <i class="fa fa-upload mr-1"></i> Importar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="ibox-content" id="app" th:fragment="list(page)">
        <form th:action="@{/templates}" method="get" id="filterForm">
            <!-- Mantenir params de paginació -->
            <input type="hidden" name="page" th:value="${param.page}"/>
            <input type="hidden" name="size" th:value="${param.size}"/>

            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-sm table-sort align-middle">
                    <thead>
                    <tr>
                        <th psd:table-sort="code">
                            <div class="text-center">Codi</div>
                            <input type="text" name="searchCode" th:value="${searchCode}"
                                   class="form-control form-control-sm"
                                   placeholder="Filtrar per codi..."
                                   style="font-size: 0.9em;"
                                   onchange="document.getElementById('filterForm').submit()">
                        </th>
                        <th psd:table-sort="name">
                            <div class="text-center">Nom</div>
                            <input type="text" name="searchName" th:value="${searchName}"
                                   class="form-control form-control-sm"
                                   placeholder="Filtrar per nom..."
                                   style="font-size: 0.9em;"
                                   onchange="document.getElementById('filterForm').submit()">
                        </th>
                        <th psd:table-sort="creatorUnit">
                            <div class="text-center">Unitat Creadora</div>
                            <input type="text" name="searchUnit" th:value="${searchUnit}"
                                   class="form-control form-control-sm"
                                   placeholder="Filtrar per unitat..."
                                   style="font-size: 0.9em;"
                                   onchange="document.getElementById('filterForm').submit()">
                        </th>
                        <th psd:table-sort="creatorUser">
                            <div class="text-center">Usuari Creador</div>
                            <input type="text" name="searchUser" th:value="${searchUser}"
                                   class="form-control form-control-sm"
                                   placeholder="Filtrar per usuari..."
                                   style="font-size: 0.9em;"
                                   onchange="document.getElementById('filterForm').submit()">
                        </th>
                        <th psd:table-sort="lastUpdated" class="text-center">Data Modificat</th>
                        <th class="text-center">Accions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="taulademo : ${page.content}">
                        <td th:text="${taulademo.code}"/>
                        <td th:text="${taulademo.name}"/>
                        <td th:text="${taulademo.creatorUnit}"/>
                        <td th:text="${taulademo.creatorUser}"/>
                        <td th:text="${taulademo.lastUpdated}"/>
                        <td class="text-center">
                            <div class="d-flex justify-content-center gap-1">
                                <a th:href="@{/templates/edit/{id}(id=${taulademo.id})}"
                                   class="btn btn-success btn-sm mr-1"
                                   title="Editar">
                                    <i class="fa fa-pencil"></i>
                                </a>
                                <a th:href="@{/templates/show/{id}(id=${taulademo.id})}"
                                   class="btn btn-secondary btn-sm mr-1"
                                   title="Veure">
                                    <i class="fa fa-eye"></i>
                                </a>
                                <button type="button"
                                        class="btn btn-primary btn-sm mr-1 export-btn"
                                        title="Exportar"
                                        onclick="handleExportClick(this)"
                                        th:attr="data-id=${taulademo.id}, data-code=${taulademo.code}">
                                    <i class="fa fa-arrow-down"></i>
                                </button>
                                <button type="button"
                                        class="btn btn-danger btn-sm mr-1"
                                        title="Eliminar"
                                        th:onclick="'deleteTemplate(' + ${taulademo.id} + ')'">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </form>
        <th:block
                th:insert="~{dipta-layouts/main/pagination :: links( page = ${page}, pageNumbers = ${pageNumbers} ) }"></th:block>

        <script th:src="@{/scripts/commonLists.js}"></script>
        <script type="module" th:src="@{/scripts/templates/templates-global.js}"></script>
    </div>

    <footer>
        <th:block th:insert="~{dipta-layouts/main/pagination :: resum( page = ${page} ) }"></th:block>
    </footer>
</div>
</body>
</html>